function Event(a,b){return this.target=a,this.value=b,this}function magic(a,b){if(this._parents=[],this._props={},this._actions={},this._storage=[],a&&a.defaults)for(var c in a.defaults)this.create(c,a.defaults[c]);for(var d in a)this[d]=a[d];return this.length=0,this._cursor=0,this.options=a,this.init&&this.init.apply(this,b),this}function Model(a){var b=function(){return magic.call(this,a,arguments)};return b.prototype=Object.create(Model.prototype),b.prototype.constructor=Model,b}function Modelp(a){return"object"==typeof a&&Array.isArray(a._storage)&&Array.isArray(a._parents)}function addParent(a,b,c){if(Modelp(a)){var d=null;if(a._parents.forEach(function(a){return d=d||b===a}),!d)return a._parents.push(b),c?b.once("change:"+c,function(b){return a._parents.remove(b.target)}):b.on("remove",function(b){return b.target===a?a._parents.remove(b.target):null})}}function getset(a,b,c){return 1===arguments.length?this.get(a):this.set(a,b,c)}function View(a){var b=function(b){if(this.model=b,this.$el=$("<div>"),a){if(a.tagName&&(this.$el=$("<"+a.tagName+">")),a.style&&this.$el.css(a.style),a.model&&(this[a.model]=b),this.$el.attr("class",a.className||a.type),a.render||(a.renderAugmented?this.render=a.renderAugmented:this.render=function(){return this.$el}),a.render&&(a.renderAugmented||(this.render=function(){return this.$el.children().detach(),a.originalRender.call(this)},a.renderAugmented=this.render,a.originalRender=a.render,delete a.render)),a.init||(a.initAugmented?this.init=a.initAugmented:this.init=function(){return this.render()}),a.events)for(var c in a.events)this.$el.on(c,a.events[c].bind(this));return magic.call(this,a,arguments),this.render(),this}};return b.prototype=Object.create(Model.prototype),b.prototype.constructor=View,b}Array.prototype.remove=function(a){for(var b=0,c=null,d=0;d<this.length;d+=1){if(c=this[d],c===a)return this.splice(b,1),!0;++b}return null},Model.prototype.copy=function(){var a=Model(this.options),b=new a;for(var c in this._props){b.destroy(c,!0);var d=this._props[c];Modelp(d)?b.create(c,this._props[c].copy()):b.create(c,Array.isArray(d)||"object"==typeof d?JSON.parse(JSON.stringify(d)):d)}b._actions={};for(var e in this._actions){for(var f=this._actions[e],g=[],h=null,i=0;i<f.length;i+=1)h=f[i],h.self===this?g.push({message:h.message,fun:h.fun,self:b}):g.push({message:h.message,fun:h.fun,self:h.self});b._actions[e]=g}var j=this.map(function(a){return Modelp(a)?a.copy():JSON.parse(JSON.stringify(a))});return b.clear(!0),j.forEach(function(a){return b.push(a,!0)}),b},Model.prototype.get=function(a,b){if(!this._props.hasOwnProperty(a))throw new Error("Attempt to get a property "+a+" that does not exist.");return b||(this.trigger("get",this[a]),this.trigger("get:"+a,this[a])),this._props[a]},Model.prototype.create=function(a,b,c){if(this._props.hasOwnProperty(a))throw new Error("Attempt to create property "+a+" that already exists.");return this._props[a]=b,this[a]=getset.bind(this,a),addParent(b,this,a),c||(this.trigger("create",b),this.trigger("create:"+a,b)),b},Model.prototype.set=function(a,b,c){if(!this._props.hasOwnProperty(a))throw new Error("Attempt to set a property "+a+" that does not exist.");var d=this._props[a];return this._props[a]=b,c||(this.trigger("change",d),this.trigger("change:"+a,d)),addParent(b,this,a),b},Model.prototype.destroy=function(a){var b=this._props[a];return delete this._props[a],delete this._actions["change:"+a],delete this[a],this.trigger("destroy",b)},Model.prototype.trigger=function(a,b,c){var d=this._actions[a],e=null;if(d){for(var f=new Event(c||this,b),g=[],h=null,i=0;i<d.length;i+=1)h=d[i],h.fun.call(h.self,f)===!0&&(e=!0),h.once&&g.push(h);for(var h=null,j=0;j<g.length;j+=1)h=g[j],d.remove(h)}else e=!0;if(e)for(var k=null,l=this._parents,m=0;m<l.length;m+=1)k=l[m],k!==c&&this.trigger.call(k,a,b,c||this)},Model.prototype.on=function(a,b,c){var d={message:a,fun:b,self:c||this};return this._actions[a]?this._actions[a].push(d):this._actions[a]=[d],d},Model.prototype.once=function(a,b,c){var d={message:a,fun:b,self:c||this,once:!0};return this._actions[a]?this._actions[a].push(d):this._actions[a]=[d],d},Model.prototype.push=function(a,b){if(this.contains&&a.type!==this.contains)throw new Error("Attempt to push "+a.type+"into container for "+this.contains);return addParent(a,this),this._storage.push(a),this.length=this._storage.length,b||(this.trigger("add",a),this.trigger("modified",[a])),a},Model.prototype.add=function(a,b){if(this.contains&&a.type!==this.contains)throw new Error("Attempt to push "+a.type+"into container for "+this.contains);return this.find(a)||this.push(a,b),a},Model.prototype.insertAt=function(a,b,c){return this._storage.splice(a,0,b),++this.length,addParent(b,this),c||(this.trigger("add",b),this.trigger("modified",[b])),b},Model.prototype.swap=function(a,b,c){var d=this.at(a),e=this.at(b);return this._storage[a]=e,this._storage[b]=d,c||this.trigger("modified",[d,e]),!0},Model.prototype.remove=function(a,b){var c=this._storage.remove(a);return c&&(--this.length,Modelp(a)&&a._parents.remove(this),b||(this.trigger("remove",a),this.trigger("modified",[a]))),c},Model.prototype.clear=function(a){var b=this._storage;this._storage=[],this.length=0;for(var c=null,d=0;d<b.length;d+=1)c=b[d],Modelp(c)&&c._parents.remove(this);return a?void 0:(this.trigger("clear",this),this.trigger("modified",b))},Model.prototype.at=function(a){if(a>=this.length)throw new Error("attempt to index ("+a+") out of range of object ("+this.length+")");return this._storage[a]},Model.prototype.current=function(a){return a?typeof a(equalsequals,"object")?this._current=this.indexOf(a):this._current=a:this.at(this._current)},Model.prototype.start=function(){return this._current=0,this.current()},Model.prototype.end=function(){return this._current=this.length-1,this.current()},Model.prototype.next=function(a){return a?this._current=(++this._current%this.length+this.length)%this.length:this._current<this.length-1?(++this._current,this.at(this._current)):void 0},Model.prototype.prev=function(a){return a?0===this._current?this._current=this.length-1:--this._current:this._current>0?(--this._current,this.at(this._current)):void 0},Model.prototype.indexOf=function(a){var b=-1;return this.find(function(c){return++b,c===a})&&b},Model.prototype.each=function(a,b){for(var c=b||this,d=null,e=this._storage,f=0;f<e.length;f+=1)d=e[f],a.call(c,d)},Model.prototype.map=function(a,b){for(var c=[],d=b||this,e=null,f=this._storage,g=0;g<f.length;g+=1)e=f[g],c.push(a.call(d,e));return c},Model.prototype.filter=function(a,b){for(var c=[],d=b||this,e=null,f=this._storage,g=0;g<f.length;g+=1)e=f[g],a.call(d,e)&&c.push(e);return c},Model.prototype.find=function(a,b){if("function"==typeof a){for(var c=null,d=this._storage,e=0;e<d.length;e+=1)if(c=d[e],a.call(b||this,c))return c}else for(var c=null,f=this._storage,g=0;g<f.length;g+=1)if(c=f[g],a===c)return c},Model.prototype.sort=function(a,b){return this._storage.sort(a),b||this.trigger("modified",this._storage),this},"undefined"!=typeof module&&(module.exports.Model=Model),"undefined"!=typeof module&&(module.exports.View=View);