function Event(a,b){return this.target=a,this.value=b,this}function magic(a,b){if(this._parents=[],this._members={},this._actions={},this._storage=[],a&&a.defaults)for(var c in a.defaults)this.create(c,a.defaults[c]);for(var d in a)this[d]=a[d];return this.length=0,this._cursor=0,this._options=a,this.init&&this.init.apply(this,b),this}function Model(a){var b=function(){return magic.call(this,a,arguments)};return b.prototype=Object.create(Model.prototype),b.prototype.constructor=Model,b}function Modelp(a){return"object"==typeof a&&Array.isArray(a._storage)&&Array.isArray(a._parents)}function addParent(a,b,c){if(Modelp(a)){var d=null;if(a._parents.forEach(function(a){return d=d||b===a}),!d)return a._parents.push(b),c?b.once("change:"+c,function(b){return a._parents.remove(b.target)}):b.on("remove",function(b){return b.target===a?a._parents.remove(b.target):null})}}function getset(a,b,c){return 1===arguments.length?this.get(a):this.set(a,b,c)}function View(a){var b=function(b){if(this.model=b,this.$el=$("<div>"),a){if(a.tagName&&(this.$el=$("<"+a.tagName+">")),a.style&&this.$el.css(a.style),a.model&&(this[a.model]=b),this.$el.attr("class",a.className&&a.type?0===a.className.indexOf(" ")?a.type+a.className:a.className:a.className?a.className:a.type),a.render||(a.renderAugmented?this.render=a.renderAugmented:this.render=function(){return this.$el}),a.render&&(a.renderAugmented||(this.render=function(){return this.$el.children().detach(),a.originalRender.call(this)},a.renderAugmented=this.render,a.originalRender=a.render,delete a.render)),a.init||(a.initAugmented?this.init=a.initAugmented:this.init=function(){return this.render()}),a.init&&(a.initAugmented||(this.init=function(){return a.originalInit.apply(this,arguments),this.render()},a.initAugmented=this.init,a.originalInit=a.init,delete a.init)),a.events)for(var c in a.events)this.$el.on(c,a.events[c].bind(this));return magic.call(this,a,arguments),this}};return b.prototype=Object.create(Model.prototype),b.prototype.constructor=View,b}Array.prototype.remove=function(a){for(var b=0,c=null,d=0;d<this.length;d+=1){if(c=this[d],c===a)return this.splice(b,1),!0;++b}return null},Model.prototype.copy=function(){var a=Model(this._options),b=new a;for(var c in this._members){b.destroy(c,!0);var d=this._members[c];Modelp(d)?b.create(c,this._members[c].copy()):b.create(c,Array.isArray(d)||"object"==typeof d?JSON.parse(JSON.stringify(d)):d)}b._actions={};for(var e in this._actions){for(var f=this._actions[e],g=[],h=null,i=0;i<f.length;i+=1)h=f[i],h.self===this?g.push({message:h.message,fun:h.fun,self:b}):g.push({message:h.message,fun:h.fun,self:h.self});b._actions[e]=g}var j=this.map(function(a){return Modelp(a)?a.copy():JSON.parse(JSON.stringify(a))});return b.clear(!0),j.forEach(function(a){return b.push(a,!0)}),b},Model.prototype.get=function(a,b){if(!this._members.hasOwnProperty(a))throw new Error("Attempt to get a property "+a+" that does not exist.");return b&&(this.trigger("get",this[a]),this.trigger("get:"+a,this[a])),this._members[a]},Model.prototype.create=function(a,b,c){if(this._members.hasOwnProperty(a))throw new Error("Attempt to create property "+a+" that already exists.");return this._members[a]=b,this[a]=getset.bind(this,a),addParent(b,this,a),c||(this.trigger("create",b),this.trigger("create:"+a,b)),b},Model.prototype.set=function(a,b,c){if(!this._members.hasOwnProperty(a))throw new Error("Attempt to set a property "+a+" that does not exist.");var d=this._members[a];return this._members[a]=b,c||(this.trigger("change",d),this.trigger("change:"+a,d)),addParent(b,this,a),b},Model.prototype.destroy=function(a){var b=this._members[a];return delete this._members[a],delete this._actions["change:"+a],delete this[a],this.trigger("destroy",b)},Model.prototype.trigger=function(a,b,c){var d=this._actions[a],e=null;if(d){for(var f=new Event(c||this,b),g=[],h=null,i=0;i<d.length;i+=1)h=d[i],h.fun.call(h.self,f)===!0&&(e=!0),h.once&&g.push(h);for(var h=null,j=0;j<g.length;j+=1)h=g[j],d.remove(h)}else e=!0;if(e)for(var k=null,l=this._parents,m=0;m<l.length;m+=1)k=l[m],k!==c&&this.trigger.call(k,a,b,c||this)},Model.prototype.on=function(a,b,c){var d={message:a,fun:b,self:c||this};return this._actions[a]?this._actions[a].push(d):this._actions[a]=[d],d},Model.prototype.once=function(a,b,c){var d={message:a,fun:b,self:c||this,once:!0};return this._actions[a]?this._actions[a].push(d):this._actions[a]=[d],d},Model.prototype.push=function(a,b){if(this.contains&&a.type!==this.contains)throw new Error("Attempt to push "+a.type+"into container for "+this.contains);return addParent(a,this),this._storage.push(a),this.length=this._storage.length,b||(this.trigger("add",a),this.trigger("modified",[a])),a},Model.prototype.add=function(a,b){if(this.contains&&a.type!==this.contains)throw new Error("Attempt to push "+a.type+"into container for "+this.contains);return this.find(a)||this.push(a,b),a},Model.prototype.insertAt=function(a,b,c){return this._storage.splice(a,0,b),++this.length,addParent(b,this),c||(this.trigger("add",b),this.trigger("modified",[b])),b},Model.prototype.swap=function(a,b,c){var d=this.at(a),e=this.at(b);return this._storage[a]=e,this._storage[b]=d,c||this.trigger("modified",[d,e]),!0},Model.prototype.remove=function(a,b){var c=this._storage.remove(a);return c&&(--this.length,Modelp(a)&&a._parents.remove(this),b||(this.trigger("remove",a),this.trigger("modified",[a]))),c},Model.prototype.clear=function(a){var b=this._storage;this._storage=[],this.length=0;for(var c=null,d=0;d<b.length;d+=1)c=b[d],Modelp(c)&&c._parents.remove(this);return a?void 0:(this.trigger("clear",this),this.trigger("modified",b))},Model.prototype.at=function(a){if(a>=this.length)throw new Error("attempt to index ("+a+") out of range of object ("+this.length+")");return this._storage[a]},Model.prototype.current=function(a,b){if(void 0!==a){var c=this.at(this._current),d=null;return d="object"==typeof a?this.at(this._current=this.indexOf(a)):this.at(this._current=a),b||(this.trigger("change",c),this.trigger("change:current",c)),d}return this.at(this._current)},Model.prototype.start=function(a){return this.current(0,a)},Model.prototype.end=function(a){return this.current(this.length-1,a)},Model.prototype.next=function(a,b){return a?this.current((this._current+1)%this.length,b):this._current<this.length-1?this.current(this._current+1,b):void 0},Model.prototype.prev=function(a,b){return a?0===this._current?this.current(this.length-1,b):this.current(this._current-1,b):this._current>0?this.current(this._current-1,b):void 0},Model.prototype.indexOf=function(a){var b=-1;return this.find(function(c){return++b,c===a})&&b},Model.prototype.each=function(a,b){for(var c=b||this,d=null,e=this._storage,f=0;f<e.length;f+=1)d=e[f],a.call(c,d)},Model.prototype.forIn=function(a,b){var c=b||this;for(var d in this._members)a.call(c,d,this._members[d])},Model.prototype.map=function(a,b){for(var c=[],d=b||this,e=null,f=this._storage,g=0;g<f.length;g+=1)e=f[g],c.push(a.call(d,e));return c},Model.prototype.filter=function(a,b){for(var c=[],d=b||this,e=null,f=this._storage,g=0;g<f.length;g+=1)e=f[g],a.call(d,e)&&c.push(e);return c},Model.prototype.find=function(a,b){if("function"==typeof a){for(var c=null,d=this._storage,e=0;e<d.length;e+=1)if(c=d[e],a.call(b||this,c))return c}else for(var c=null,f=this._storage,g=0;g<f.length;g+=1)if(c=f[g],a===c)return c},Model.prototype.sort=function(a,b){return this._storage.sort(a),b||this.trigger("modified",this._storage),this},Model.prototype.serialize=function(){var a,b,c={},d=null,e=[],f={};for(var g in this._members)c[g]=(a=this._members[g],Modelp(a)?this._members[g].serialize():Array.isArray(a)||"object"==typeof a?JSON.stringify(JSON.stringify(a)):a);d=this.map(function(a){return Modelp(a)?a.serialize():a});var h=function(a){if("function"==typeof a)return["function","var x = "+a.toString()+";x"];if("object"==typeof a){var b={};for(var c in a)b[c]=h(a[c]);return["object",b]}return["other",a]};for(var i in this._options)f[i]=(b=this._options[i],h(b));for(var j in this._actions)for(var k=this._actions[j],l=null,m=0;m<k.length;m+=1)l=k[m],e.push({message:l.message,fun:"var x = "+l.fun.toString()+";x",self:l.self===this?"this":Modelp(l)?l.serialize():l,once:l.once});return{members:c,storage:d,actions:e,options:f}},Model.prototype.load=function(obj,loadActions){var model30,deserializedThing31,serializedp=function(a){return!(void 0===a.members||void 0===a.storage||void 0===a.actions||void 0===a.options)},deserializeOptions=function(options){for(var option in options)with({thing:null}){var thing=options[option];options[option]=function(){switch(thing[0]){case"function":return eval(thing[1]).bind(this);case"object":for(var key in thing)thing[key]=deserializeOptions(thing[key]);return thing;case"other":return thing}}()}return options},members25=obj.members,storage26=obj.storage,actions27=obj.actions,options28=deserializeOptions(obj.options);if(serializedp(obj))for(var member in members25){var thing=members25[member];if(serializedp(thing)){var model=new new Model(thing.options),deserializedThing=model.load(thing);this[member]?this[member](deserializedThing):this.create(member,deserializedThing)}else this[member]?this[member](thing):this.create(member,thing)}this.clear();for(var thing=null,_js_idx29=0;_js_idx29<storage26.length;_js_idx29+=1)thing=storage26[_js_idx29],this.add(serializedp(thing)?(model30=new new Model(thing.options),deserializedThing31=model30.load(thing)):thing,!0);if(loadActions)for(var action=null,_js_idx30=0;_js_idx30<actions27.length;_js_idx30+=1)action=actions27[_js_idx30],this.on(action.message,eval(action.fun).bind("this"===action["this"]?this:null),action.once);return this},"undefined"!=typeof module&&(module.exports.Model=Model),"undefined"!=typeof module&&(module.exports.View=View);